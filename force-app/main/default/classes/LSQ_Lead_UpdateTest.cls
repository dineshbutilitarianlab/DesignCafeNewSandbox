@isTest
public class LSQ_Lead_UpdateTest {
    /*@isTest
    static void testSendUpdatedDataToLSQ() {
        List<Lead> leadList = [SELECT Id FROM Lead LIMIT 1];
		Map<Id, List<String>> leadIdToChangedFieldsMap = new Map<Id, List<String>>();  
        List<Id> leadIdSet = new List<Id>();
        for (Lead leadRecord : leadList) {
            leadIdSet.add(leadRecord.Id);
        	leadIdToChangedFieldsMap.put(leadRecord.Id, new List<String>{'DC_Lead_Status__c','Channel__c','Live__c'});
        }
        Test.setMock(HttpCalloutMock.class, new MockHttpResponseGenerator());
        Test.startTest();
        LSQ_Lead_Update.sendUpdatedDataToLSQ(leadIdSet,leadIdToChangedFieldsMap);
        Test.stopTest();
        
        Integer calloutCount = Limits.getCallouts();
        System.assertEquals(1, calloutCount, 'A single callout should have been made');
    }
    @testSetup
    private static void createLead() {
        
        TriggerControl__c cuset1 = new TriggerControl__c();
        cuset1.Name = 'LeadTrigger';
        cuset1.Run__c = true;
        insert cuset1;
        
        DCWebengage__c dcWeb = new DCWebengage__c();
        dcWeb.Name = 'Dcwebengage';
        dcWeb.url__c ='https://api.webengage.com/v1/accounts/76aa813/users';        
        insert dcWeb;
      
        Design_User__c du = new Design_User__c();
        du.name = 'test du user';
        du.Designer_Dashboard_ID__c = 'test du';
        du.Email__c = 'test@test.com';
        du.Role__c = 'Design Partner';
        insert du;
        
        Profile systemAdminProfile = [SELECT Id, Name FROM Profile where Name = 'System Administrator'];
        User systemAdminUser = [SELECT Id, Name,ProfileId FROM User WHERE ProfileId =: systemAdminProfile.Id and IsActive = true Limit 1];
        
        System.runAs(systemAdminUser){
           
            List<Lead> l = new List<Lead>();
            Lead ld = new Lead();
            ld.Channel__c = 'Online';
            ld.LastName = 'test';
            ld.FirstName = 'lead';
            ld.MiddleName = 'tesing';
            ld.Suffix = 'salesforce';
            ld.City = 'Bengaluru';
            ld.Email = 'Bengaluru@gmail.com';
            ld.DSA__c = accDSA.id;
            ld.DSA_Code__c = 'testing';
            ld.Designer__c = uDesign.Id;
            ld.Status='FollowUp';
            ld.DC_Lead_Status__c = 'No Response';
            ld.IsConverted = false;
            ld.Follow_Up_Date_Time__c = system.today()+5;
            ld.Property_Possession_Date__c = date.today();
            ld.LSQ_Lead_Related_ID__c = 'test';
            ld.Client_s_Budget__c = 30000;
            ld.Status = 'Followup';
            ld.Email = 'test@gmail.com';
            ld.Phone = '675432310';
            ld.LeadSource = 'Google AdWords';
            ld.NumberOfEmployees = 3;
            ld.Industry = 'Banking';
            ld.Campagin__c = 'test campagin';
            ld.Company = 'salechaa';
            ld.DoNotCall = false;
            ld.HasOptedOutOfEmail = true;
            ld.Fax = '123-455-7890';
            ld.HasOptedOutOfFax = false;
            ld.AnnualRevenue = 2300000;
            ld.Salutation = 'Mrs';
             ld.Rating = 'Hot';
            ld.Website = 'https://www.w3.org/Provider/Style/dummy.html';
             ld.Title = 'title';
            ld.Ad_Network__c = 'testnetwork';
            ld.Ad_Name__c = 'testName';//ld.AdWords_Mobile__c = '8976543231';
            ld.Affiliate_Name__c = 'affiliatename';
            ld.Agency__c = 'Syrow';
             ld.Age_of_First_kid__c = 'firstKid';
            ld.Age_of_Second_kid__c = 'secondKid';
            ld.Age_of_Fourth_kid__c= 'fourthkid';
            ld.Age_of_Third_kid__c = 'thirdKid';
            //ld.Alternate_Contact_Number__c = '8787654323';
            ld.Approx_Budget__c = '5L to 7L';
             ld.Attempt_Count__c = 20;
            ld.Bell_N1_Sent__c = false;
            ld.Bell_N2_Sent__c = false;
            ld.Bell_N3_Sent__c = false;
            ld.Broadcast_Status__c = '5';
            ld.bypassSMleadOwnervalidation__c = false;
            ld.BypassTimebasedWorkflow__c = true;
            ld.Cab_Req__c = 'No';
            ld.Call_Center_Agent_Team__c = 'LTC-Bangalore;LTC Hyderabad;LTC Mumbai';
            ld.Call_Center_Agent_Region__c = 'Bengaluru;Mumbai;Hyderabad';
            ld.Call_Count__c = 2;
            ld.Callrecording__c = 'textrecording';
            ld.CallUniqueI__c = 'callText';
            ld.DC_Campaign_Source__c = 'Google AdWords';
            ld.Channel__c = 'Online';
            ld.Civil_Work__c = true;
            ld.Client_Site_visit__c = 'Completed';
            ld.CMM_Name__c = 'cmmName';
            ld.Country_Code__c = '7676456596';
            ld.Customer_Pincode__c = '876543';
             ld.Customer_Language_Preference__c = 'Kannada';
            ld.Date_When_Meeting_is_Scheduled__c = date.today();
            ld.DC_Home_Visit__c = 'Completed';
            ld.Delay_in_response__c = true;
            ld.Designers_TL_Email__c = 'test@gmail.com';
            ld.Designers_Email__c = 'test35@gmail.com';
            ld.Designer_Team_Name__c = 'designerName';
            ld.Designer_TL_s_Manager_Email__c = 'manager@test.com';
            ld.Device_Type__c = 'deviceType';
            ld.DialPad_Input_Knowlarity__c = 'dailpadInput';
            ld.Do_you_have_pets__c = 'doyouhave';
            ld.DSA_Category__c = 'Interior Designing Firm';
            ld.DSA_Code__c = '78782eed3';
            ld.DSA_Email__c = 'dsa@testing.com';
            ld.DUP_Update_Owner__c = false;
            ld.Eat__c = 'Cook at home';
            ld.EM4Hr__c = DateTime.now()+1;
            ld.Email_from_Data_Dump__c = 'emailfromData';
            ld.EmployeeCode__c = 'ee0934532';
            ld.Entry_Url__c = 'https://www.w3.org/dummy2.html';
            ld.File_Url__c = 'https://www.org/dummy2.html';
            ld.First_Date_of_Contact__c = Date.today()+1;
            ld.First_Meeting_Date__c = Date.today();
            ld.First_Response_Actual__c = DateTime.now()+1;
            ld.floor_plan_attachment_id__c = '1631';
            ld.Area__c = '1200';
            ld.Floor_Area__c = '1233';
            ld.Floor_Plan_Link_from_Chatbot__c = 'testing';
            ld.Follow_Up_Count__c = 1;
            ld.Follow_Up_Date_Time__c = DateTime.now();
            ld.Fourth_Date_of_Contact__c =  Date.today()+1;
            ld.GCLID__c = 'example';
            ld.Gender_of_First_kid__c = 'test';
            ld.Gender_of_Third_kid__c = 'testing';
            ld.Gender_of_Fourth_kid__c = 'example';
            ld.Gender_of_Second_kid__c = 'second';
            ld.Has_Designer_Accepted__c = 'Designer Not Assigned';
             ld.Home_Type__c = 'Villa';
            ld.How_did_you_hear_about_us__c = 'Online';
               ld.How_many_kids_do_you_have__c = '4';
            ld.If_other_languages_please_specify__c = '3';
            ld.Inbound_Call__c = 'test';
             ld.Initial_Call_Stage__c  = 'example1';
             ld.Interior_work_needed_for__c = 'Modular Kitchen';
            ld.Is_Customer_Created__c = true;
            ld.Is_Bulk_Upload__c = true;
            ld.Is_Designer_Assigned__c = false;
            ld.Is_Lead_Update__c = true;
            ld.Is_MS__c = false;
            ld.Keyword__c = 'testing';
            ld.Knew_about_Design_Cafe_Because__c = 'Advertisements';
            ld.LARR__c = false;
            ld.Last_Source__c = 'Direct';
            ld.Lead_Allocation_Time__c = DateTime.now();
             ld.Lead_Allocation_time_to_SM__c = DateTime.now()+1;
            //ld.Lead_Designer_is_Current_User__c = false;
            //ld.Lead_Generator__c = 'Test';
            ld.Lead_Qualified_for__c = 'Qarpentri';
            ld.Lead_Qualified_Date__c = Date.today();
            ld.DC_Lead_Source__c = 'Google Display Ads';
             ld.Moderator__c = '99 Acres';
            ld.Move_in__c = Date.today();
            ld.MS_Delay_in_response__c = false;
            ld.MS_First_Response_Actual__c = DateTime.now()+1;
            ld.MS_Follow_Up_Count__c = 1;
            ld.Preferred_Time_to_Contact__c  = DateTime.now().time();
            ld.New_TimeStamp__c = DateTime.now();
            ld.NotConnected_TimeStamp__c = DateTime.now();
            ld.Offer_of_the_Month__c = 'DCOFFERCE';
            ld.Old_Source__c = 'testing';
            ld.Others_for_Live__c = 'test2';
            ld.Others_for_Play__c = 'example'; 
            ld.OTP_Verified__c = 'YES';
            ld.Owner__c = 'test2';
            ld.Page__c = 'testting';
             ld.PB_BS_0_or_2__c = true;
            ld.PB_BS_1_or_3_or_4__c = true;
            ld.PB_Design_user_assigned__c = true;
            ld.Play__c = 'Reading(C10 - Book unit)';
            ld.PPT_Uploaded__c = false;
             ld.Pre_Qualified_Date__c = Date.today()+1;
            ld.Pre_Qualified_FollowUp_Date__c = Date.today()+1;
            ld.Project_Name__c = 'projectTest';
            ld.Property_Address__c = 'addrees1';
            ld.Property_Possession_Date__c = Date.today();
            ld.Property_Possession_Status__c = 'Property due - this month';
            ld.RecordForDeletion__c = true;
            ld.Referrer_City__c = 'city';
            ld.Region__c = 'Chennai';
            
            
            insert ld;
            Task t = new Task(IsReminderSet = true, whoId = ld.Id, status='Open');              
            insert t;
            ld.Region__c = ld.City;
            ld.LastName = 'test2';
            ld.FirstName = 'lead2';
            ld.MiddleName = 'tesing2';
            ld.Suffix = 'salesforce2';
            ld.Designer__c = uDesign.Id;
            ld.Meeting_Venue__c='MGDC';
            ld.Meeting_Type__c='EC';
            ld.Willingness_For_Meeting__c = date.today().addDays(5);
            ld.Status = 'Prospect';
            ld.DC_Lead_Status__c = 'Pre-qualified';
            ld.Description = 'Updated Description';
            ld.Email = 'test123@gmail.com';
            ld.Client_s_Budget__c = 20000;
            ld.Status = 'Junk';
            ld.Broadcast_Status__c = '0';
            ld.Phone = '7333231023';
            ld.LeadSource = 'Direct';
            ld.NumberOfEmployees = 2;
            ld.Industry = 'Apparel';
            ld.Campagin__c = 'test campagin2';
            ld.Company = 'Design Cafe';
            ld.DoNotCall = true;
            ld.HasOptedOutOfEmail = false;
            ld.Fax = '123-456-7890';
            ld.HasOptedOutOfFax = true;
            ld.AnnualRevenue = 1000000;
            ld.Salutation = 'Mr';
            ld.Rating = 'Warm';
            ld.Website = 'https://www.w3.org/Provider/Style2/dummy.html';
            ld.Title = 'title2';
            ld.Ad_Network__c = 'testnetwork2';
            ld.Ad_Name__c = 'testName2';
            //ld.AdWords_Mobile__c = '8976543000';
            ld.Affiliate_Name__c = 'affiliatename2';
            ld.Agency__c = 'LT2';
            ld.Age_of_First_kid__c = 'firstKid2';
            ld.Age_of_Second_kid__c = 'secondKid';
            ld.Age_of_Fourth_kid__c= 'fourthkid2';
            ld.Age_of_Third_kid__c = 'thirdKid2';
             //ld.Alternate_Contact_Number__c = '8787654786';
             ld.Approx_Budget__c = '10L to 12L';
            ld.Attempt_Count__c = 2;
            ld.Bell_N1_Sent__c = true;
            ld.Bell_N2_Sent__c = true;
            ld.Bell_N3_Sent__c = true;
            ld.Broadcast_Status__c = '6';
            ld.bypassSMleadOwnervalidation__c = true;
            ld.BypassTimebasedWorkflow__c = false;
            ld.Cab_Req__c = 'Yes';
            ld.Call_Center_Agent_Team__c = 'LTC-Bangalore;LTC-Bangalore-Offline;LTC Hyderabad;LTC Mumbai';
            ld.Call_Center_Agent_Region__c = 'Bengaluru;Mumbai;Hyderabad;Bengaluru;Mumbai;Hyderabad';
            ld.Call_Count__c = 4;
            ld.Callrecording__c = 'textrecording2';
            ld.CallUniqueI__c = 'callText2';
            ld.DC_Campaign_Source__c = 'Organic Search';
             ld.Channel__c = 'Offline';
            ld.Civil_Work__c = false;
            ld.Client_Site_visit__c = 'Requested';
            ld.CMM_Name__c = 'cmmName2';
            ld.MobilePhone = '8976543234';
            ld.Country_Code__c = '7676453896';
            ld.Customer_Pincode__c = '876565'; 
            ld.Customer_Language_Preference__c = 'English';
            ld.Date_When_Meeting_is_Scheduled__c = date.today().addDays(5);
            ld.DC_Home_Visit__c = 'Requested';
            ld.Delay_in_response__c = false;
            ld.Designers_TL_Email__c = 'test2@gmail.com';
            ld.Designers_Email__c = 'test3@gmail.com';
            ld.Designer_Team_Name__c = 'designerName2';
            ld.Designer_TL_s_Manager_Email__c = 'manager2@test.com';
            ld.Device_Type__c = 'deviceType2';
            ld.DialPad_Input_Knowlarity__c = 'dailpadInputknow';
            ld.Do_you_have_pets__c = 'doyouhavepets';
            ld.DSA_Category__c = 'Architect Firm';
            ld.DSA_Code__c = '882eed3';
            ld.DSA_Email__c = 'dsa@test.com';
            ld.DUP_Update_Owner__c = true;
            ld.Eat__c = 'Maid cooks all meals';
            ld.EM4Hr__c = DateTime.now();
            ld.Email_from_Data_Dump__c = 'emailfromDataDump';
            ld.EmployeeCode__c = 'eef9345321';
            ld.Entry_Url__c = 'https://www.w3.org/dummy.html';
            ld.File_Url__c = 'https://www.org/dum.html';
            ld.First_Date_of_Contact__c = Date.today();
             ld.First_Meeting_Date__c = Date.today()+1;
            ld.First_Response_Actual__c = DateTime.now();
            ld.floor_plan_attachment_id__c = '1632';
            ld.Area__c = '2200';
            ld.Floor_Area__c = '1233';
            ld.Floor_Plan_Link_from_Chatbot__c = 'testing';
            ld.Follow_Up_Count__c = 0;
            ld.Follow_Up_Date_Time__c = DateTime.now()+1;
            ld.Fourth_Date_of_Contact__c =  Date.today();
            ld.GCLID__c = 'example2';
            ld.Gender_of_First_kid__c = 'test2'; 
            ld.Gender_of_Third_kid__c = 'testing2';
            ld.Gender_of_Fourth_kid__c = 'example2';
            ld.Gender_of_Second_kid__c = 'second2';
            ld.Has_Designer_Accepted__c = 'Designer Accepted';
            ld.Home_Type__c = '2 BHK';
            ld.How_did_you_hear_about_us__c = 'Social Media';
            ld.How_many_kids_do_you_have__c = '2';
            ld.If_other_languages_please_specify__c = '2';
             ld.Inbound_Call__c = 'testing';
            ld.Initial_Call_Stage__c  = 'example';
            ld.Interior_work_needed_for__c = 'Living Room';
             ld.Is_Customer_Created__c = false;
            ld.Is_Bulk_Upload__c=false;
            ld.Is_Designer_Assigned__c = true;
            ld.Is_Lead_Update__c = false;
            ld.Is_MS__c = true;
            ld.Keyword__c = 'testing1';
            ld.Knew_about_Design_Cafe_Because__c = 'Article';
            ld.LARR__c = true;
            ld.Last_Source__c = 'AdWords';
             ld.Lead_Allocation_Time__c = DateTime.now()+1;
            ld.Lead_Allocation_time_to_SM__c = DateTime.now();
            //ld.Lead_Designer_is_Current_User__c = true;
            ld.Lead_Generator__c = 'Nikhil';
            ld.Lead_Qualified_for__c = 'Design Cafe';
            ld.Lead_Qualified_Date__c = Date.today();
            ld.DC_Lead_Source__c = 'Google Search Organic';
            ld.Moderator__c = 'AdCanopus';
             ld.Move_in__c = Date.today()+1;
            ld.MS_Delay_in_response__c = true;
            ld.MS_First_Response_Actual__c = DateTime.now();
            ld.MS_Follow_Up_Count__c = 10;
            ld.New_TimeStamp__c = DateTime.now()+1;
            ld.NotConnected_TimeStamp__c = DateTime.now()+1;
            ld.Offer_of_the_Month__c = 'DCOFFERCODE';
            ld.Old_Source__c = 'testing1';
            ld.Others_for_Live__c = 'test';
            ld.Others_for_Play__c = 'example1';
            ld.OTP_Verified__c = 'NO';
            ld.Owner__c = 'test';
            ld.Page__c = 'testting1';
            ld.PB_BS_0_or_2__c = false;
            ld.PB_BS_1_or_3_or_4__c = false;
             ld.PB_Design_user_assigned__c = false;
             ld.PB_Design_user_assigned__c = false;
            ld.Play__c = 'Cooking / Baking';
            ld.PPT_Uploaded__c = true;
            ld.Pre_Qualified_Date__c = Date.today();
            ld.Pre_Qualified_FollowUp_Date__c = Date.today();
            ld.Project_Name__c = 'projectTest1';
            ld.Property_Address__c = 'addrees123';
            ld.Property_Possession_Date__c = Date.today()+1;
            ld.Property_Possession_Status__c = 'Property in possession';
            ld.RecordForDeletion__c = false;
            ld.Referrer_City__c = 'city1';
            ld.Region__c ='Bengaluru';
            ld.Requirement_Details__c = 'TV Unit';
            update ld;
    	}
        
    }*/
     public static void testSetup() {
        DCWebengage__c  cuset2= new DCWebengage__c();
        cuset2.Name = 'Dcwebengage';
        cuset2.BearerToken__c = '097a1996-03d2-4870-8bbc-339eb9e239b7';
        cuset2.url__c= 'https://api.webengage.com/v1/accounts/aa131ca9/users';
        insert cuset2; 
         
        TriggerControl__c cuset1 = new TriggerControl__c();
        cuset1.Name = 'LeadTrigger';
        cuset1.Run__c = true;
        insert cuset1; 
         
        SRR__c SRRmum = new SRR__c();
        SRRmum.Name = 'Mumbai';
        SRRmum.index__c = 0;
        insert SRRmum;
        SRR__c SRRWDC = new SRR__c();
        SRRWDC.Name = 'WDC';
        SRRWDC.index__c = 0;
        insert SRRWDC;
        SRR__c SRRHyd = new SRR__c();
        SRRHyd.Name = 'Hyderabad';
        SRRHyd.index__c = 0;
        insert SRRHyd;
        SRR__c SRRMGDC = new SRR__c();
        SRRMGDC.Name = 'MGDC';
        SRRMGDC.index__c = 0;
        insert SRRMGDC;
        SRR__c SRRHSR = new SRR__c();
        SRRHSR.Name = 'HSR';
        SRRHSR.index__c = 0;
        insert SRRHSR;
        SRR__c SRRCHE = new SRR__c();
        SRRCHE.Name = 'Chennai';
        SRRCHE.index__c = 0;
        insert SRRCHE;
        SRR__c SRRjpdc = new SRR__c();
        SRRjpdc.Name = 'JPDC';
        SRRjpdc.index__c = 0;
        insert SRRjpdc;
        SRR__c SRRthane = new SRR__c();
        SRRthane.Name = 'Thane DC';
        SRRthane.index__c = 0;
        insert SRRthane;
        SRR__c SRRKDRMYS = new SRR__c();
        SRRKDRMYS.Name = 'KDRMYS';
        SRRKDRMYS.index__c = 0;
        insert SRRKDRMYS;
        SRR__c SRRYERPUN = new SRR__c();
        SRRYERPUN.Name = 'YERPUN';
        SRRYERPUN.index__c = 0;
        insert SRRYERPUN;
        SRR__c SRRBHHYD = new SRR__c();
        SRRBHHYD.Name = 'BHHYD';
        SRRBHHYD.index__c = 0;
        insert SRRBHHYD;
        SRR__c SRRSJPBLR = new SRR__c();
        SRRSJPBLR.Name = 'SJPBLR';
        SRRSJPBLR.index__c = 0;
        insert SRRSJPBLR;
        SRR__c SRRKHMUM = new SRR__c();
        SRRKHMUM.Name = 'KHMUM';
        SRRKHMUM.index__c = 0;
        insert SRRKHMUM;
        SRR__c SRRWLMUM = new SRR__c();
        SRRWLMUM.Name = 'WLMUM';
        SRRWLMUM.index__c = 0;
        insert SRRWLMUM;
        SRR__c SRROMRCH = new SRR__c();
        SRROMRCH.Name = 'OMRCH';
        SRROMRCH.index__c = 0;
        insert SRROMRCH;
        
        SRR__c SRRHRBR = new SRR__c();
        SRRHRBR.Name = 'HRBRBLR';
        SRRHRBR.index__c = 0;
        insert SRRHRBR;
        
        CPPortal__c  cuset3= new CPPortal__c();
        cuset3.Name = 'cpportalupdate';
        cuset3.url__c= 'https://uat-api.designcafe.com/pp/updateLead';
        insert cuset3; 
        CPPortal__c  cuset4= new CPPortal__c();
        cuset4.Name = 'cpportalinsert';
        cuset4.url__c= 'https://uat-api.designcafe.com/pp/insertLead';
        insert cuset4;
        
        TriggerControl__c tc = new TriggerControl__c(Name = 'LeadTrigger', Run__c = true);
        insert tc;
        
        Design_User__c designUsers = new Design_User__c(
            Name = 'Test Design User 1',
            Designer_Dashboard_ID__c = '355',
            Role__c= 'Inhouse Designer',
            Email__c = 'test@gmail.com',
            Mobile__c = '7834764321',
            Region__c = 'Bengaluru',
            Experience_Center__c = 'HSRDC'   
        );
        
        
        Lead testLead = new Lead(
            FirstName = 'Test',
            LastName = 'Lead',
            Company = 'Test Company',
            Status = 'New',
            LARR__c = false,
            bypassSMleadOwnervalidation__c = true,
            Design_User__c = designUsers.id,
            city = 'Bengaluru'
        );
        
        Lead testLead2 = new Lead(
            FirstName = 'Test2',
            LastName = 'Lead',
            Company = 'Test Company',
            Status = 'New',
            LARR__c = false,
            bypassSMleadOwnervalidation__c = false,
            Design_User__c = designUsers.id,
            city = 'Mumbai'
        );
        
        insert testLead2;
        insert testLead;   
    }
    
    
    @isTest
    public static void LdTrigger1(){
        TriggerControl__c cuset1 = new TriggerControl__c();
        cuset1.Name = 'LeadTrigger';
        cuset1.Run__c = true;
        insert cuset1; 
        
        user uDesign = [select id,name from user where profile.name = 'System Administrator' and team__c != null limit 1];
        Id salesRecId   = Schema.SObjectType.Account.getRecordTypeInfosByName().get('Sales Partner').getRecordTypeId();
        Id empRecId     = Schema.SObjectType.Account.getRecordTypeInfosByName().get('Employee').getRecordTypeId();
        Account accDSA  = new Account(Name ='DSA', RecordTypeId = salesRecId,Channel_Marketing_Manager__c=uDesign.id ,CMM_Name__c='CMM');
        insert accDSA;
        Account accRef  = new Account(lastName ='Refree',RecordTypeId = empRecId );
        insert accRef;
        account acc=[select Referee_Code_DC__c from account where id=:accRef.id];
        
        Profile p = [SELECT Id FROM Profile WHERE Name='Standard User' LIMIT 1];
        User testUser = new User(
            Alias = 'exclusr',
            Email = 'excludeduser@example.com',
            EmailEncodingKey = 'UTF-8',
            LastName = 'Test',
            LanguageLocaleKey = 'en_US',
            LocaleSidKey = 'en_US',
            ProfileId = p.Id,
            TimeZoneSidKey = 'America/Los_Angeles',
            UserName = 'excludeduser@example.com'
        );
        insert testUser;
        
        System.runAs(testUser) {
            
            List<Lead> l = new List<Lead>();
            Lead ld = new Lead();
            ld.Channel__c = 'Online';
            ld.LastName = 'test';
            ld.FirstName = 'lead';
            ld.MiddleName = 'tesing';
            ld.Suffix = 'salesforce';
            ld.City = 'Bengaluru';
            ld.Email = 'Bengaluru@gmail.com';
            ld.DSA__c = accDSA.id;
            ld.DSA_Code__c = 'testing';
            ld.Designer__c = uDesign.Id;
            ld.Status='FollowUp';
            ld.DC_Lead_Status__c = 'New';
            ld.IsConverted = false;
            ld.Follow_Up_Date_Time__c = system.today()+5;
            ld.Property_Possession_Date__c = date.today();
            ld.LSQ_Lead_Related_ID__c = 'test';
            ld.Client_s_Budget__c = 30000;
            ld.Status = 'Followup';
            ld.Email = 'test@gmail.com';
            ld.Phone = '675432310';
            ld.LeadSource = 'Google AdWords';
            ld.NumberOfEmployees = 3;
            ld.Industry = 'Banking';
            ld.Campagin__c = 'test campagin';
            ld.Company = 'salechaa';
            ld.DoNotCall = false;
            ld.HasOptedOutOfEmail = true;
            ld.Fax = '123-455-7890';
            ld.HasOptedOutOfFax = false;
            ld.AnnualRevenue = 2300000;
            ld.Salutation = 'Mrs';
            ld.Rating = 'Hot';
            ld.Website = 'https://www.w3.org/Provider/Style/dummy.html';
            ld.Title = 'title';
            ld.Ad_Network__c = 'testnetwork';
            ld.Ad_Name__c = 'testName';//ld.AdWords_Mobile__c = '8976543231';
            ld.Affiliate_Name__c = 'affiliatename';
            ld.Agency__c = 'Syrow';
            ld.Age_of_First_kid__c = 'firstKid';
            ld.Age_of_Second_kid__c = 'secondKid';
            ld.Age_of_Fourth_kid__c= 'fourthkid';
            ld.Age_of_Third_kid__c = 'thirdKid';
            //ld.Alternate_Contact_Number__c = '8787654323';
            ld.Approx_Budget__c = '5L to 7L';
            ld.Attempt_Count__c = 20;
            ld.Bell_N1_Sent__c = false;
            ld.Bell_N2_Sent__c = false;
            ld.Bell_N3_Sent__c = false;
            ld.Broadcast_Status__c = '5';
            ld.bypassSMleadOwnervalidation__c = false;
            ld.BypassTimebasedWorkflow__c = true;
            ld.Cab_Req__c = 'No';
            ld.Call_Center_Agent_Team__c = 'LTC-Bangalore;LTC Hyderabad;LTC Mumbai';
            ld.Call_Center_Agent_Region__c = 'Bengaluru;Mumbai;Hyderabad';
            ld.Call_Count__c = 2;
            ld.Callrecording__c = 'textrecording';
            ld.CallUniqueI__c = 'callText';
            ld.DC_Campaign_Source__c = 'Google AdWords';
            ld.Channel__c = 'Online';
            ld.Civil_Work__c = true;
            ld.Client_Site_visit__c = 'Completed';
            ld.CMM_Name__c = 'cmmName';
            ld.Country_Code__c = '7676456596';
            ld.Customer_Pincode__c = '876543';
            ld.Customer_Language_Preference__c = 'Kannada';
            ld.Date_When_Meeting_is_Scheduled__c = date.today();
            ld.DC_Home_Visit__c = 'Completed';
            ld.Delay_in_response__c = true;
            ld.Designers_TL_Email__c = 'test@gmail.com';
            ld.Designers_Email__c = 'test35@gmail.com';
            ld.Designer_Team_Name__c = 'designerName';
            ld.Designer_TL_s_Manager_Email__c = 'manager@test.com';
            ld.Device_Type__c = 'deviceType';
            ld.DialPad_Input_Knowlarity__c = 'dailpadInput';
            ld.Do_you_have_pets__c = 'doyouhave';
            ld.DSA_Category__c = 'Interior Designing Firm';
            ld.DSA_Code__c = '78782eed3';
            ld.DSA_Email__c = 'dsa@testing.com';
            ld.DUP_Update_Owner__c = false;
            ld.Eat__c = 'Cook at home';
            ld.EM4Hr__c = DateTime.now()+1;
            ld.Email_from_Data_Dump__c = 'emailfromData';
            ld.EmployeeCode__c = 'ee0934532';
            ld.Entry_Url__c = 'https://www.w3.org/dummy2.html';
            ld.File_Url__c = 'https://www.w3.org/dummy2.html';
            ld.First_Date_of_Contact__c = Date.today()+1;
            ld.First_Meeting_Date__c = Date.today();
            ld.First_Response_Actual__c = DateTime.now()+1;
            ld.floor_plan_attachment_id__c = '1631';
            ld.Area__c = '1200';
            ld.Floor_Area__c = '1233';
            ld.Floor_Plan_Link_from_Chatbot__c = 'testing';
            ld.Follow_Up_Count__c = 1;
            ld.Follow_Up_Date_Time__c = DateTime.now();
            ld.Fourth_Date_of_Contact__c =  Date.today()+1;
            ld.GCLID__c = 'example';
            ld.Gender_of_First_kid__c = 'test';
            ld.Gender_of_Third_kid__c = 'testing';
            ld.Gender_of_Fourth_kid__c = 'example';
            ld.Gender_of_Second_kid__c = 'second';
            ld.Has_Designer_Accepted__c = 'Designer Not Assigned';
            ld.Home_Type__c = 'Villa';
            ld.How_did_you_hear_about_us__c = 'Online';
            ld.How_many_kids_do_you_have__c = '4';
            ld.If_other_languages_please_specify__c = '3';
            ld.Inbound_Call__c = 'test';
            ld.Initial_Call_Stage__c  = 'example1';
            ld.Interior_work_needed_for__c = 'Modular Kitchen';
            ld.Is_Customer_Created__c = true;
            ld.Is_Bulk_Upload__c = true;
            ld.Is_Designer_Assigned__c = false;
            ld.Is_Lead_Update__c = true;
            ld.Is_MS__c = false;
            ld.Keyword__c = 'testing';
            ld.Knew_about_Design_Cafe_Because__c = 'Advertisements';
            ld.LARR__c = false;
            ld.Last_Source__c = 'Direct';
            ld.Lead_Allocation_Time__c = DateTime.now();
            ld.Lead_Allocation_time_to_SM__c = DateTime.now()+1;
            //ld.Lead_Designer_is_Current_User__c = false;
            ld.Lead_Generator__c = 'Gautam';
            ld.Lead_Qualified_for__c = 'Qarpentri';
            ld.Lead_Qualified_Date__c = Date.today();
            ld.DC_Lead_Source__c = 'Google Display Ads';
            ld.Moderator__c = '99 Acres';
            ld.Move_in__c = Date.today();
            ld.MS_Delay_in_response__c = false;
            ld.MS_First_Response_Actual__c = DateTime.now()+1;
            ld.MS_Follow_Up_Count__c = 1;
            ld.New_TimeStamp__c = DateTime.now();
            ld.NotConnected_TimeStamp__c = DateTime.now();
            ld.Offer_of_the_Month__c = 'DCOFFERCE';
            ld.Old_Source__c = 'testing';
            ld.Others_for_Live__c = 'test2';
            ld.Others_for_Play__c = 'example'; 
            ld.OTP_Verified__c = 'YES';
            ld.Owner__c = 'test2';
            ld.Page__c = 'testting';
            ld.PB_BS_0_or_2__c = true;
            ld.PB_BS_1_or_3_or_4__c = true;
            ld.PB_Design_user_assigned__c = true;
            ld.Play__c = 'Reading(C10 - Book unit)';
            ld.PPT_Uploaded__c = false;
            ld.Pre_Qualified_Date__c = Date.today()+1;
            ld.Pre_Qualified_FollowUp_Date__c = Date.today()+1;
            ld.Project_Name__c = 'projectTest';
            ld.Property_Address__c = 'addrees1';
            ld.Property_Possession_Date__c = Date.today();
            ld.Property_Possession_Status__c = 'Property due - this month';
            ld.RecordForDeletion__c = true;
            ld.Referrer_City__c = 'city';
            ld.Region__c = 'Chennai';
            ld.Scope_Of_Work__c = 'Partial renovation for your flat/house';
            ld.Secondary_Email__c = 'testing@gmail.com';
            ld.Second_Date_of_Contact__c = Date.today()+1;
            //ld.Site_Service_Needed_for__c = 'False Ceiling';
            ld.Source__c = 'Organic';
            ld.Source_Journey__c = 'testing';
            ld.Third_Date_of_Contact__c = Date.today();
            ld.Total_Call_Duration__c = 23;
            ld.Twitter__c = 'twitter';
            ld.Unread_Time__c =  DateTime.now();
            ld.User_Browser__c = 'userbrowser';
            ld.User_Last_Url__c = 'useUrl';
            ld.User_OS__c = 'userOs';
            ld.Voucher_Code__c = 'voucher1';
            ld.Whatsapp_Opt_IN__c = false;
            ld.When_would_you_like_to_have_the_home__c = '3 to 4 Months';
            ld.Who_will_be_staying_in_the_house__c = 'Parents';
            ld.Which_language_are_you_most_comfortable__c = 'kannada';
            ld.Who_will_be_staying_in_the_house__c = 'Parents';
            ld.Wohoo_Card__c = 'test';
            ld.Work__c = 'No';
            ld.XUID__c = 'test1';
            ld.Flat_Number__c = '123';
            ld.For_Reassignment__c = false;
            ld.IP_Address__c = 'test';
            ld.Lead_Source_Sub_Category__c = 'Google Display Ads';
            ld.Location__c = '';
            ld.Page_URL_1__c = 'testurl';
            ld.Page_Variant__c = 'tesing2';
            ld.Partner_Notification__c = true;
            ld.Property_Type__c = 'property1';
            ld.Property_Type_For_Interior__c = 'Flat';
            ld.Qualified_Status__c = '';
            ld.Recontacted__c = true;
            ld.Referral_Mobile__c = '8976567231';
            ld.Submission_Date_Time__c = DateTime.now()+1;
            ld.Units_Required__c = 112346;
            ld.Status ='New';
           ld.Jigsaw = 'test';
            ld.CMM_Team__c ='test';
            ld.Converted_TimeStamp__c = DateTime.now()+1;
            ld.Connected_TimeStamp__c = DateTime.now();
            ld.FBCLID__c = 'test';
            ld.File_Name__c = 'filename';
            ld.First_Visit_Time__c = 'firstVisit';
            ld.Floor_Area__c = 'area1';
            insert ld;
            
            Test.startTest();
            VDC_LeadProcesstoApex.firstRun = true;
            
            
            Task t = new Task(IsReminderSet = true, whoId = ld.Id, status='Open');              
            insert t;
            ld.Region__c = ld.City;
            ld.LastName = 'test2';
            ld.FirstName = 'lead2';
            ld.MiddleName = 'tesing2';
            ld.Suffix = 'salesforce2';
            ld.Designer__c = uDesign.Id;
            ld.Meeting_Venue__c='MGDC';
            ld.Meeting_Type__c='EC';
            ld.Willingness_For_Meeting__c = date.today().addDays(5);
            ld.Status = 'Prospect';
            ld.DC_Lead_Status__c = 'Pre-qualified';
            ld.Description = 'Updated Description';
            ld.Email = 'test123@gmail.com';
            ld.Client_s_Budget__c = 20000;
            ld.Status = 'Junk';
            ld.Broadcast_Status__c = '0';
            ld.Phone = '7333231023';
            ld.LeadSource = 'Direct';
            ld.NumberOfEmployees = 2;
            ld.Industry = 'Apparel';
            ld.Campagin__c = 'test campagin2';
            ld.Company = 'Design Cafe';
            ld.DoNotCall = true;
            ld.HasOptedOutOfEmail = false;
            ld.Fax = '123-456-7890';
            ld.HasOptedOutOfFax = true;
            ld.AnnualRevenue = 1000000;
            ld.Salutation = 'Mr';
            ld.Rating = 'Warm';
            ld.Website = 'https://www.w3.org/Provider/Style2/dummy.html';
            ld.Title = 'title2';
            ld.Ad_Network__c = 'testnetwork2';
            ld.Ad_Name__c = 'testName2';
            //ld.AdWords_Mobile__c = '8976543000';
            ld.Affiliate_Name__c = 'affiliatename2';
            ld.Agency__c = 'LT2';
            ld.Age_of_First_kid__c = 'firstKid2';
            ld.Age_of_Second_kid__c = 'secondKid';
            ld.Age_of_Fourth_kid__c= 'fourthkid2';
            ld.Age_of_Third_kid__c = 'thirdKid2';
            //ld.Alternate_Contact_Number__c = '8787654786';
            ld.Approx_Budget__c = '10L to 12L';
            ld.Attempt_Count__c = 2;
            ld.Bell_N1_Sent__c = true;
            ld.Bell_N2_Sent__c = true;
            ld.Bell_N3_Sent__c = true;
            ld.Broadcast_Status__c = '6';
            ld.bypassSMleadOwnervalidation__c = true;
            ld.BypassTimebasedWorkflow__c = false;
            ld.Cab_Req__c = 'Yes';
            ld.Call_Center_Agent_Team__c = 'LTC-Bangalore;LTC-Bangalore-Offline;LTC Hyderabad;LTC Mumbai';
            ld.Call_Center_Agent_Region__c = 'Bengaluru;Mumbai;Hyderabad;Bengaluru;Mumbai;Hyderabad';
            ld.Call_Count__c = 4;
            ld.Callrecording__c = 'textrecording2';
            ld.CallUniqueI__c = 'callText2';
            ld.DC_Campaign_Source__c = 'Organic Search';
            ld.Channel__c = 'Offline';
            ld.Civil_Work__c = false;
            ld.Client_Site_visit__c = 'Requested';
            ld.CMM_Name__c = 'cmmName2';
            ld.MobilePhone = '8976543234';
            ld.Country_Code__c = '7676453896';
            ld.Customer_Pincode__c = '876565'; 
            ld.Customer_Language_Preference__c = 'English';
            ld.Date_When_Meeting_is_Scheduled__c = date.today().addDays(5);
            ld.DC_Home_Visit__c = 'Requested';
            ld.Delay_in_response__c = false;
            ld.Designers_TL_Email__c = 'test2@gmail.com';
            ld.Designers_Email__c = 'test3@gmail.com';
            ld.Designer_Team_Name__c = 'designerName2';
            ld.Designer_TL_s_Manager_Email__c = 'manager2@test.com';
            ld.Device_Type__c = 'deviceType2';
            ld.DialPad_Input_Knowlarity__c = 'dailpadInputknow';
            ld.Do_you_have_pets__c = 'doyouhavepets';
            ld.DSA_Category__c = 'Architect Firm';
            ld.DSA_Code__c = '882eed3';
            ld.DSA_Email__c = 'dsa@test.com';
            ld.DUP_Update_Owner__c = true;
            ld.Eat__c = 'Maid cooks all meals';
            ld.EM4Hr__c = DateTime.now();
            ld.Email_from_Data_Dump__c = 'emailfromDataDump';
            ld.EmployeeCode__c = 'eef9345321';
            ld.Entry_Url__c = 'https://www.w3.org/dummy.html';
            ld.File_Url__c = 'https://www.org/dum.html';
            ld.First_Date_of_Contact__c = Date.today();
            ld.First_Meeting_Date__c = Date.today()+1;
            ld.First_Response_Actual__c = DateTime.now();
            ld.floor_plan_attachment_id__c = '1632';
            ld.Area__c = '2200';
            ld.Floor_Area__c = '1233';
            ld.Floor_Plan_Link_from_Chatbot__c = 'testing';
            ld.Follow_Up_Count__c = 0;
            ld.Follow_Up_Date_Time__c = DateTime.now()+1;
            ld.Fourth_Date_of_Contact__c =  Date.today();
            ld.GCLID__c = 'example2';
            ld.Gender_of_First_kid__c = 'test2'; 
            ld.Gender_of_Third_kid__c = 'testing2';
            ld.Gender_of_Fourth_kid__c = 'example2';
            ld.Gender_of_Second_kid__c = 'second2';
            ld.Has_Designer_Accepted__c = 'Designer Accepted';
            ld.Home_Type__c = '2 BHK';
            ld.How_did_you_hear_about_us__c = 'Social Media';
            ld.How_many_kids_do_you_have__c = '2';
            ld.If_other_languages_please_specify__c = '2';
            ld.Inbound_Call__c = 'testing';
            ld.Initial_Call_Stage__c  = 'example';
            ld.Interior_work_needed_for__c = 'Living Room';
            ld.Is_Customer_Created__c = false;
            ld.Is_Bulk_Upload__c=false;
            ld.Is_Designer_Assigned__c = true;
            ld.Is_Lead_Update__c = false;
            ld.Is_MS__c = true;
            ld.Keyword__c = 'testing1';
            ld.Knew_about_Design_Cafe_Because__c = 'Article';
            ld.LARR__c = true;
            ld.Last_Source__c = 'AdWords';
            ld.Lead_Allocation_Time__c = DateTime.now()+1;
            ld.Lead_Allocation_time_to_SM__c = DateTime.now();
            //ld.Lead_Designer_is_Current_User__c = true;
            ld.Lead_Generator__c = 'Nikhil';
            ld.Lead_Qualified_for__c = 'Design Cafe';
            ld.Lead_Qualified_Date__c = Date.today();
            ld.DC_Lead_Source__c = 'Google Search Organic';
            ld.Moderator__c = 'AdCanopus';
            ld.Move_in__c = Date.today()+1;
            ld.MS_Delay_in_response__c = true;
            ld.MS_First_Response_Actual__c = DateTime.now();
            ld.MS_Follow_Up_Count__c = 10;
            ld.New_TimeStamp__c = DateTime.now()+1;
            ld.NotConnected_TimeStamp__c = DateTime.now()+1;
            ld.Offer_of_the_Month__c = 'DCOFFERCODE';
            ld.Old_Source__c = 'testing1';
            ld.Others_for_Live__c = 'test';
            ld.Others_for_Play__c = 'example1';
            ld.OTP_Verified__c = 'NO';
            ld.Owner__c = 'test';
            ld.Page__c = 'testting1';
            ld.PB_BS_0_or_2__c = false;
            ld.PB_BS_1_or_3_or_4__c = false;
            ld.PB_Design_user_assigned__c = false;
            ld.PB_Design_user_assigned__c = false;
            ld.Play__c = 'Cooking / Baking';
            ld.PPT_Uploaded__c = true;
            ld.Pre_Qualified_Date__c = Date.today();
            ld.Pre_Qualified_FollowUp_Date__c = Date.today();
            ld.Project_Name__c = 'projectTest1';
            ld.Property_Address__c = 'addrees123';
            ld.Property_Possession_Date__c = Date.today()+1;
            ld.Property_Possession_Status__c = 'Property in possession';
            ld.RecordForDeletion__c = false;
            ld.Referrer_City__c = 'city1';
            ld.Region__c ='Bengaluru';
            ld.Requirement_Details__c = 'TV Unit';
            ld.Scope_Of_Work__c = 'Complete interiors for your new flat/house';
            ld.Secondary_Email__c = 'test@gmail.com';
            ld.Second_Date_of_Contact__c = Date.today();
            //ld.Site_Service_Needed_for__c = 'Painting';
            ld.Source__c = 'Paid';
            ld.Source_Journey__c = 'test';
            ld.Third_Date_of_Contact__c = Date.today()+1;
            ld.Total_Call_Duration__c = 12;
            ld.Twitter__c = 'twitter2';
            ld.Unread_Time__c =  DateTime.now()+1;
            ld.User_Browser__c = 'browser';
            ld.User_Last_Url__c = 'useUrl1';
            ld.User_OS__c = 'userOs1';
            ld.Voucher_Code__c = 'voucher';
            ld.Whatsapp_Opt_IN__c = true;
            ld.When_would_you_like_to_have_the_home__c = '2 to 3 Months';
            ld.Who_will_be_staying_in_the_house__c = 'US';
            ld.Which_language_are_you_most_comfortable__c = 'telugu';
            ld.Who_will_be_staying_in_the_house__c = 'Us';
            ld.Work__c = 'Yes';
            ld.XUID__c = 'test';
            ld.Flat_Number__c = '1235';
            ld.For_Reassignment__c = true;
            ld.IP_Address__c = 'testing';
            ld.Lead_Source_Sub_Category__c = 'Google Search Ads';
            ld.Location__c = 'A';
            ld.Page_URL_1__c = 'testurl1';
            ld.Page_Variant__c = 'tesing';
            ld.Partner_Notification__c = false;
            ld.Property_Type__c = 'property';
            ld.Property_Type_For_Interior__c = 'Villa';
            ld.Qualified_Status__c = 'A';
            ld.Recontacted__c = false;
            ld.Referral_Mobile__c = '8976567643';
            ld.Submission_Date_Time__c = DateTime.now();
            ld.Units_Required__c = 11234;
            //ld.Status ='Connected';
            //ld.Status = 'Not Connected';
            ld.Status = 'New';
            ld.Status = 'Meeting Confirmed';
            ld.Jigsaw = 'test1';
            ld.CMM_Team__c ='test2';
            ld.Converted_TimeStamp__c = DateTime.now();
            ld.Connected_TimeStamp__c = DateTime.now()+1;
            ld.FBCLID__c = 'test1';
            ld.File_Name__c = 'file';
            ld.First_Visit_Time__c = 'firstVisit1';
            ld.Floor_Area__c = 'area';
            update ld;
            
            Opportunity opty = new Opportunity();
            opty.Name='OppTest';
            opty.AccountId=acc.Id;
            opty.stagename = 'Meeting Done';
            opty.Amount = 999;
            opty.Wohoo_Card__c = '567';
            opty.Signup_Amount__c = 88788;
            opty.Client_s_Budget__c = 8989;
            opty.Probability = 100;
            opty.X1st_Meeting_Person__c = '0052v00000bZuLL';
            opty.X1st_Meeting_Date__c = system.today();
            opty.Meeting_Type__c = 'EC';
            opty.region__C = 'Bengaluru';
            opty.CloseDate = system.today();    
            opty.Amount=3124;
            opty.Lead_Id__c = ld.Id;
            opty.Remarks_For_Marketing__c = 'test 26-day delivery';
            opty.Offer_and_discounts__c = 'No Offer';
            insert opty;
            
            System.assertEquals(20000, ld.Client_s_Budget__c, 'Client_s_Budget__c should be updated');
            System.assertEquals('Updated Description', ld.Description, 'Description should be updated');
            //System.assertEquals(false, ld.bypassSMleadOwnervalidation__c, 'The bypass flag should be set to false');
            Test.setMock(HttpCalloutMock.class, new DC_Webengage_mockup());
            LeadTrigger_handler.getLocalDateTime(system.today());
            insert new Design_Cafe_Settings__c(SetupOwnerId=UserInfo.getOrganizationId(), Working_Hour_Start_Time__c=9,Working_Hour_End_Time__c = 18);
            LeadTrigger_handler.deadlineOfAcceptance8hoursCalculation(system.today());
            //Lead lList = [select id,MobilePhone,Region__c from Lead LIMIT 1];
        }        
    }
    
}